@model List<Collectionform>

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>My Collection</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

        <style>
            body {
                background-color: #f8f9fa;
            }

            .collection-img {
                width: 100%;
                height: 160px;
                object-fit: cover;
                border-radius: 8px 0 0 8px;
            }

            .tag-badge {
                background-color: #eef2f7;
                color: #333;
            }

            .search-box {
                background: #fff;
                padding: 15px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            }

            .floating-actions {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
            }

                .floating-actions .btn {
                    width: 50px;
                    height: 50px;
                    font-size: 24px;
                }

            .button-cnt {
                display: grid;
                grid-template-columns: auto 45px 45px;
                gap: 5px;
            }
        </style>
    </head>

    <body>

        <div class="container mt-4">

            <h2 class="fw-bold mb-4">My Collection</h2>

            <!-- Search -->
            <div class="search-box mb-4">
                <div class="row g-2">
                    <div class="col-md-8">
                        <input type="text" id="searchBox" class="form-control" placeholder="Search items..." />
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="tagFilter">
                            <option value="all">All Tags</option>
                            <option value="development">Development</option>
                            <option value="design">Design</option>
                            <option value="productivity">Productivity</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Cards -->
            @foreach (var item in Model)
    {
            <div class="card mb-3 shadow-sm search-item">
                <div class="row g-0 align-items-center">
                    <div class="col-md-3">
                        <img src="@Url.Content("~/image/" + item.imageUrl)" class="collection-img" />
                    </div>

                    <div class="col-md-9">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <h5>@item.Title</h5>
                                <span class="badge tag-badge">@item.Tag</span>
                            </div>

                            <p class="text-muted">@item.Description</p>

                            <div class="button-cnt">
                                @if (!string.IsNullOrEmpty(item.Link))
                            {
                                <a href="@item.Link" target="_blank" class="btn btn-outline-primary btn-sm">Visit</a>
                            }

                                <button class="btn btn-warning btn-sm"
                                        onclick="openEditModal('@item.id','@item.Title','@item.Description','@item.Fk_id','@item.imageUrl','@item.Link')">
                                    <i class="fa-solid fa-pen"></i>
                                </button>

                                <button class="btn btn-danger btn-sm"
                                        onclick="deleteItem(@item.id)">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    }

        </div>

        <!-- Floating Add Button -->
        <div class="floating-actions">
            <button class="btn btn-warning" onclick="openAddModal()">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="editItemModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title" id="editItemModalLabel">Add Item</h5>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <input type="hidden" id="FK_id" />

                        <div class="mb-3">
                            <label>Title</label>
                            <input type="text" id="Title" class="form-control" />
                        </div>

                        <div class="mb-3">
                            <label>Description</label>
                            <textarea id="Description" class="form-control"></textarea>
                        </div>

                        <div class="mb-3">
                            <label>Tag</label>
                            <select id="Tag" class="form-select">
                                <option value="">Select Tag</option>
                                <option value="1">Development</option>
                                <option value="2">Design</option>
                                <option value="3">Productivity</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label>Image URL</label>
                            <input type="text" id="imageUrl" class="form-control" />
                        </div>

                        <div class="mb-3">
                            <label>Link</label>
                            <input type="text" id="Link" class="form-control" />
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button class="btn btn-primary" onclick="saveItem()">Save</button>
                    </div>

                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            function openAddModal() {
                $('#editItemModalLabel').text('Add Item');
                $('#FK_id,#Title,#Description,#Tag,#imageUrl,#Link').val('');
                new bootstrap.Modal('#editItemModal').show();
            }

            function openEditModal(id, title, desc, tagId, img, link) {
                $('#editItemModalLabel').text('Edit Item');
                $('#FK_id').val(id);
                $('#Title').val(title);
                $('#Description').val(desc);
                $('#Tag').val(tagId);
                $('#imageUrl').val(img);
                $('#Link').val(link);
                new bootstrap.Modal('#editItemModal').show();
            }

            function saveItem() {
                let data = {
                    id: $('#FK_id').val() || null,
                    Title: $('#Title').val(),
                    Description: $('#Description').val(),
                    Tag: $('#Tag').val(),
                    imageUrl: $('#imageUrl').val(),
                    Link: $('#Link').val()
                };

                if (!data.Title || !data.Description || !data.Tag) {
                    alert("All fields required");
                    return;
                }

                $.ajax({
                    url: '/HomeController1/Create',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: () => location.reload()
                });
            }

            function deleteItem(id) {
                if (!confirm("Are you sure you want to delete?")) return;

                $.ajax({
                    url: '/HomeController1/Delete',
                    type: 'POST',
                    data: { id: id },
                    success: () => location.reload()
                });
            }

            // Search & filter
            $('#searchBox, #tagFilter').on('input change', function () {
                let text = $('#searchBox').val().toLowerCase();
                let tag = $('#tagFilter').val().toLowerCase();

                $('.search-item').each(function () {
                    let itemText = $(this).text().toLowerCase();
                    let itemTag = $(this).find('.tag-badge').text().toLowerCase();

                    let show = itemText.includes(text) &&
                        (tag === 'all' || itemTag === tag);

                    $(this).toggle(show);
                });
            });
        </script>

    </body>
</html>
